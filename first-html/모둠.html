<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모둠 점수 관리 앱</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        /* contenteditable의 placeholder 스타일 */
        [contenteditable]:empty:before {
            content: attr(placeholder);
            color: #a0aec0; /* gray-500 */
            pointer-events: none;
            display: block;
        }
        /* 포커스 시 아웃라인 제거 */
        [contenteditable]:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* blue-500 with opacity */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app" class="container mx-auto p-4 sm:p-6 lg:p-8">

        <!-- 페이지 1: 모둠 점수 페이지 -->
        <div id="main-page">
            <header class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-700">모둠 점수판</h1>
                <div>
                    <button id="reset-all-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">전체 초기화</button>
                    <button id="settings-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 ml-2">설정</button>
                </div>
            </header>
            <main id="groups-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- 모둠 카드가 동적으로 여기에 추가됩니다 -->
            </main>
        </div>

        <!-- 페이지 2: 설정 페이지 -->
        <div id="settings-page" class="hidden">
            <header class="flex items-center mb-6">
                 <button id="back-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 mr-4">돌아가기</button>
                <h1 class="text-3xl font-bold text-gray-700">설정</h1>
            </header>
            <main class="bg-white p-8 rounded-2xl shadow-lg">
                <div class="space-y-6">
                    <div>
                        <label for="group-count" class="block text-lg font-medium text-gray-700 mb-2">모둠 개수</label>
                        <input type="number" id="group-count" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                    <div>
                        <label for="increment-value" class="block text-lg font-medium text-gray-700 mb-2">+ 버튼 점수</label>
                        <input type="number" id="increment-value" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                    <div>
                        <label for="decrement-value" class="block text-lg font-medium text-gray-700 mb-2">- 버튼 점수</label>
                        <input type="number" id="decrement-value" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-2">모둠 이름 설정</h3>
                        <div id="group-names-container" class="space-y-3">
                            <!-- 모둠 이름 입력 필드가 여기에 추가됩니다 -->
                        </div>
                    </div>
                </div>
                 <div class="mt-8 text-right">
                    <button id="save-settings-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105">저장하기</button>
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainPage = document.getElementById('main-page');
            const settingsPage = document.getElementById('settings-page');
            const groupsContainer = document.getElementById('groups-container');

            const settingsBtn = document.getElementById('settings-btn');
            const backBtn = document.getElementById('back-btn');
            const saveSettingsBtn = document.getElementById('save-settings-btn');
            const resetAllBtn = document.getElementById('reset-all-btn');
            
            // 기본 상태
            const defaultState = {
                settings: {
                    groupCount: 4,
                    increment: 1,
                    decrement: 1,
                },
                groups: [
                    { name: '1모둠', score: 0 },
                    { name: '2모둠', score: 0 },
                    { name: '3모둠', score: 0 },
                    { name: '4모둠', score: 0 },
                ]
            };

            let state = {};

            // --- 상태 관리 ---
            function loadState() {
                const savedState = localStorage.getItem('groupScoreAppState');
                state = savedState ? JSON.parse(savedState) : JSON.parse(JSON.stringify(defaultState)); // Deep copy
            }

            function saveState() {
                localStorage.setItem('groupScoreAppState', JSON.stringify(state));
            }
            
            // --- 렌더링 ---
            function render() {
                renderGroups();
            }

            function renderGroups() {
                groupsContainer.innerHTML = ''; // 기존 카드 삭제
                state.groups.forEach((group, index) => {
                    const groupCard = document.createElement('div');
                    groupCard.className = 'bg-white p-6 rounded-2xl shadow-lg flex flex-col items-center space-y-4 transition-shadow hover:shadow-xl';
                    
                    const groupNameEl = document.createElement('h2');
                    groupNameEl.textContent = group.name;
                    groupNameEl.className = 'text-2xl font-bold text-center w-full p-2 rounded-lg hover:bg-gray-100 transition';
                    groupNameEl.contentEditable = true;
                    groupNameEl.placeholder = "모둠 이름";
                    groupNameEl.addEventListener('blur', () => {
                        state.groups[index].name = groupNameEl.textContent.trim() || `모둠 ${index + 1}`;
                        groupNameEl.textContent = state.groups[index].name;
                        saveState();
                    });

                    const scoreEl = document.createElement('p');
                    scoreEl.textContent = group.score;
                    scoreEl.className = 'text-6xl font-bold text-blue-600 my-4 w-full text-center p-2 rounded-lg hover:bg-gray-100 transition';
                    scoreEl.contentEditable = true;
                    scoreEl.addEventListener('blur', () => {
                        const newScore = parseInt(scoreEl.textContent, 10);
                        state.groups[index].score = !isNaN(newScore) ? newScore : 0;
                        scoreEl.textContent = state.groups[index].score; // Re-format
                        saveState();
                    });
                     scoreEl.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            scoreEl.blur();
                        }
                    });

                    const buttonContainer = document.createElement('div');
                    buttonContainer.className = 'flex items-center justify-center space-x-3 w-full';

                    const minusBtn = createButton('-', ['bg-red-500', 'hover:bg-red-600'], () => updateScore(index, -state.settings.decrement));
                    const plusBtn = createButton('+', ['bg-green-500', 'hover:bg-green-600'], () => updateScore(index, state.settings.increment));
                    
                    buttonContainer.appendChild(minusBtn);
                    buttonContainer.appendChild(plusBtn);
                    
                    const resetBtn = document.createElement('button');
                    resetBtn.textContent = '점수 초기화';
                    resetBtn.className = 'w-full mt-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg transition';
                    resetBtn.addEventListener('click', () => {
                        state.groups[index].score = 0;
                        saveState();
                        render();
                    });

                    groupCard.appendChild(groupNameEl);
                    groupCard.appendChild(scoreEl);
                    groupCard.appendChild(buttonContainer);
                    groupCard.appendChild(resetBtn);

                    groupsContainer.appendChild(groupCard);
                });
            }

            function createButton(text, classes, onClick) {
                const button = document.createElement('button');
                button.textContent = text;
                button.className = `w-16 h-16 text-white text-3xl font-bold rounded-full shadow-md transition-transform transform hover:scale-110 ${classes.join(' ')}`;
                button.addEventListener('click', onClick);
                return button;
            }

            function updateScore(index, change) {
                state.groups[index].score += change;
                saveState();
                render();
            }
            
            function renderSettings() {
                document.getElementById('group-count').value = state.settings.groupCount;
                document.getElementById('increment-value').value = state.settings.increment;
                document.getElementById('decrement-value').value = state.settings.decrement;
                
                const groupNamesContainer = document.getElementById('group-names-container');
                groupNamesContainer.innerHTML = '';
                
                for (let i = 0; i < state.settings.groupCount; i++) {
                    const inputGroup = document.createElement('div');
                    inputGroup.className = 'flex items-center';
                    
                    const label = document.createElement('label');
                    label.textContent = `${i + 1}모둠`;
                    label.className = 'w-20 font-medium text-gray-600';

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = state.groups[i]?.name || `${i + 1}모둠`;
                    input.className = 'group-name-input flex-1 p-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-transparent transition';
                    
                    inputGroup.appendChild(label);
                    inputGroup.appendChild(input);
                    groupNamesContainer.appendChild(inputGroup);
                }
            }
            
            // --- 이벤트 리스너 ---
            settingsBtn.addEventListener('click', () => {
                renderSettings();
                mainPage.classList.add('hidden');
                settingsPage.classList.remove('hidden');
            });

            backBtn.addEventListener('click', () => {
                settingsPage.classList.add('hidden');
                mainPage.classList.remove('hidden');
            });
            
            document.getElementById('group-count').addEventListener('change', (e) => {
                const newCount = parseInt(e.target.value, 10);
                if (newCount > 0) {
                    state.settings.groupCount = newCount;
                    // 모둠 개수 변경 시 이름 입력 필드 즉시 업데이트
                    renderSettings();
                }
            });

            saveSettingsBtn.addEventListener('click', () => {
                const newCount = parseInt(document.getElementById('group-count').value, 10);
                const newIncrement = parseInt(document.getElementById('increment-value').value, 10);
                const newDecrement = parseInt(document.getElementById('decrement-value').value, 10);
                
                state.settings.groupCount = newCount > 0 ? newCount : 1;
                state.settings.increment = !isNaN(newIncrement) ? newIncrement : 1;
                state.settings.decrement = !isNaN(newDecrement) ? newDecrement : 1;
                
                const nameInputs = document.querySelectorAll('.group-name-input');
                const newGroups = [];

                for (let i = 0; i < state.settings.groupCount; i++) {
                    const oldGroup = state.groups[i];
                    newGroups.push({
                        name: nameInputs[i].value || `${i + 1}모둠`,
                        score: oldGroup ? oldGroup.score : 0
                    });
                }
                state.groups = newGroups;
                
                saveState();
                render();
                
                settingsPage.classList.add('hidden');
                mainPage.classList.remove('hidden');
            });
            
            resetAllBtn.addEventListener('click', () => {
                if (confirm('모든 모둠의 점수를 0점으로 초기화하시겠습니까?')) {
                    state.groups.forEach(group => group.score = 0);
                    saveState();
                    render();
                }
            });

            // --- 초기화 ---
            function init() {
                loadState();
                render();
            }

            init();
        });
    </script>

</body>
</html>
