<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëœë¤ ëŒë¦¼íŒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            touch-action: manipulation; /* ëª¨ë°”ì¼ì—ì„œ ë”ë¸” íƒ­ í™•ëŒ€ ë°©ì§€ */
        }
        .wheel-container {
            position: relative;
            width: 600px;
            height: 600px;
        }
        canvas {
            transition: transform 5s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .pin {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #ef4444; /* red-500 */
            z-index: 10;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
        }
        .pin::after {
            content: '';
            position: absolute;
            top: -45px;
            left: -10px;
            width: 20px;
            height: 20px;
            background: #ef4444;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        .winner-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 20px;
            font-size: 2.5rem;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideDown 0.5s ease-out;
            display: none;
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        @media (max-width: 768px) {
            .wheel-container {
                width: 400px;
                height: 400px;
            }
            .winner-message {
                font-size: 1.8rem;
                padding: 15px 30px;
            }
        }
        @media (max-width: 480px) {
            .wheel-container {
                width: 300px;
                height: 300px;
            }
            .winner-message {
                font-size: 1.5rem;
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body class="bg-white text-slate-800 flex flex-col items-center justify-center min-h-screen p-4">

    <!-- ë‹¹ì²¨ ë©”ì‹œì§€ -->
    <div id="winner-message" class="winner-message">
        ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤, <span id="winner-name"></span> ğŸ‰
    </div>

    <!-- ì¶”ì²¨í•­ëª© ì…ë ¥ ëª¨ë‹¬ -->
    <div id="items-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-slate-700">ì¶”ì²¨ í•­ëª© ì…ë ¥</h2>
            <textarea id="items" rows="15" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="ì—¬ê¸°ì— í•­ëª©ì„ í•œ ì¤„ì— í•˜ë‚˜ì”© ì…ë ¥í•˜ì„¸ìš”.&#10;ì˜ˆì‹œ)&#10;í™ê¸¸ë™&#10;ê¹€ì² ìˆ˜&#10;ì´ì˜í¬"></textarea>
            <div class="flex space-x-2 mt-4">
                <button id="set-button" class="flex-1 bg-indigo-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-600 active:bg-indigo-700 transition-transform transform active:scale-95">
                    ì„¤ì • ì™„ë£Œ
                </button>
                <button id="cancel-button" class="flex-1 bg-slate-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-slate-600 active:bg-slate-700 transition-transform transform active:scale-95">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>

    <div class="w-full max-w-5xl mx-auto text-center">
        <h1 class="text-4xl font-bold mb-8 text-slate-700 drop-shadow-md">ëŒ€í˜• ëœë¤ ëŒë¦¼íŒ</h1>

        <!-- Wheel -->
        <div class="flex flex-col items-center justify-center space-y-6 mb-6">
            <div class="wheel-container">
                <div class="pin"></div>
                <canvas id="wheel" width="600" height="600"></canvas>
            </div>
            <button id="spin-button" class="w-full max-w-md bg-red-500 text-white text-3xl font-bold py-6 px-8 rounded-2xl hover:bg-red-600 active:bg-red-700 transition-all transform hover:scale-105 active:scale-95 shadow-2xl disabled:bg-slate-300 disabled:cursor-not-allowed disabled:transform-none">
                ëŒë¦¬ê¸°!
            </button>
        </div>

        <!-- Control Buttons -->
        <div class="flex flex-wrap justify-center gap-4 mt-8">
            <button id="edit-button" class="bg-indigo-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-600 active:bg-indigo-700 transition-transform transform active:scale-95 shadow-lg">
                ğŸ“ ì¶”ì²¨í•­ëª© ìˆ˜ì •
            </button>
            <button id="reset-button" class="bg-slate-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-slate-600 active:bg-slate-700 transition-transform transform active:scale-95 shadow-lg">
                ğŸ”„ ì´ˆê¸°í™”
            </button>
            <button id="show-drawn-button" class="bg-green-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-600 active:bg-green-700 transition-transform transform active:scale-95 shadow-lg">
                ğŸ“‹ ë½‘íŒ í•­ëª© ë³´ê¸°
            </button>
        </div>
    </div>

    <!-- ë½‘íŒ í•­ëª© ëª¨ë‹¬ -->
    <div id="drawn-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-slate-700">ë½‘íŒ í•­ëª©</h2>
            <div class="bg-slate-50 p-4 rounded-lg max-h-96 overflow-y-auto">
                <ul id="drawn-item-list" class="space-y-2 text-lg text-slate-700">
                    <!-- ë½‘íŒ í•­ëª©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </ul>
            </div>
            <button id="close-drawn-button" class="w-full mt-4 bg-slate-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-slate-600 active:bg-slate-700 transition-transform transform active:scale-95">
                ë‹«ê¸°
            </button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spin-button');
        const setButton = document.getElementById('set-button');
        const resetButton = document.getElementById('reset-button');
        const editButton = document.getElementById('edit-button');
        const cancelButton = document.getElementById('cancel-button');
        const showDrawnButton = document.getElementById('show-drawn-button');
        const closeDrawnButton = document.getElementById('close-drawn-button');
        const itemsTextarea = document.getElementById('items');
        const drawnItemList = document.getElementById('drawn-item-list');
        const itemsModal = document.getElementById('items-modal');
        const drawnModal = document.getElementById('drawn-modal');
        const winnerMessage = document.getElementById('winner-message');
        const winnerName = document.getElementById('winner-name');

        let items = [];
        let isSpinning = false;
        let currentRotation = 0;
        let winnerItem = null;
        let popOutAnimationId = null;
        let popOutProgress = 0;
        let tickInterval = null;

        // Web Audio API ì´ˆê¸°í™”
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // í‹± ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
        function playTickSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.05);
        }

        // ìŠ¹ë¦¬ íŒ¡íŒŒë ˆ ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
        function playWinSound() {
            const notes = [523.25, 659.25, 783.99, 1046.50]; // C, E, G, C (higher)
            notes.forEach((freq, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = freq;
                oscillator.type = 'sine';
                
                const startTime = audioContext.currentTime + index * 0.15;
                gainNode.gain.setValueAtTime(0.3, startTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                
                oscillator.start(startTime);
                oscillator.stop(startTime + 0.3);
            });
        }

        const colors = [
            "#f87171", "#fb923c", "#facc15", "#a3e635", "#4ade80", "#34d399",
            "#2dd4bf", "#22d3ee", "#38bdf8", "#60a5fa", "#818cf8", "#a78bfa",
            "#c084fc", "#e879f9", "#f472b6", "#fb7185"
        ];

        function resizeCanvas() {
            const container = canvas.parentElement;
            const size = Math.min(container.clientWidth, container.clientHeight);
            canvas.width = size;
            canvas.height = size;
            if (items.length > 0) drawWheel();
        }

        function drawWheel() {
            const activeItems = items.filter(item => !item.selected);
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (activeItems.length === 0 && items.length > 0) {
                ctx.fillStyle = '#64748b';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.font = 'bold 24px Noto Sans KR';
                ctx.fillText('ëª¨ë“  í•­ëª©ì„ ë½‘ì•˜ìŠµë‹ˆë‹¤!', centerX, centerY);
                spinButton.disabled = true;
                return;
            }

            const arcSize = 2 * Math.PI / activeItems.length;
            const radius = Math.min(centerX, centerY) * 0.9;
            // í•­ëª© ìˆ˜ê°€ ë§ì„ ë•Œ ê¸€ì í¬ê¸° ì¡°ì •
            let fontSize = Math.max(10, Math.min(20, radius / (activeItems.length * 0.08)));
            ctx.font = `bold ${fontSize}px Noto Sans KR`;

            activeItems.forEach((item, i) => {
                const angle = i * arcSize;
                
                ctx.save();
                
                // Winner pop-out animation
                if (winnerItem && item.name === winnerItem.name) {
                    const popOutDistance = radius * 0.08 * popOutProgress;
                    const midAngle = angle + arcSize / 2;
                    ctx.translate(Math.cos(midAngle) * popOutDistance, Math.sin(midAngle) * popOutDistance);
                    ctx.shadowColor = 'rgba(0,0,0,0.3)';
                    ctx.shadowBlur = 15;
                    ctx.strokeStyle = "#f59e0b";
                    ctx.lineWidth = 5;
                } else {
                    ctx.strokeStyle = "#ffffff";
                    ctx.lineWidth = 3;
                }
                
                // Draw segment
                ctx.beginPath();
                ctx.fillStyle = item.color;
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, angle, angle + arcSize);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                // Draw text on top
                ctx.save();
                ctx.fillStyle = getContrastColor(item.color);
                ctx.translate(centerX, centerY);
                ctx.rotate(angle + arcSize / 2);
                ctx.textAlign = 'right';
                ctx.textBaseline = 'middle';
                // í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ ìœ„ì¹˜ ì¡°ì •
                const maxTextWidth = radius * 0.8;
                const text = item.name;
                let textWidth = ctx.measureText(text).width;
                if (textWidth > maxTextWidth) {
                    ctx.font = `bold ${fontSize * 0.8}px Noto Sans KR`;
                }
                ctx.fillText(text, radius * 0.85, 0);
                ctx.restore();

                ctx.restore(); 
            });
        }

        function animateWinnerPopOut() {
            if (popOutAnimationId) cancelAnimationFrame(popOutAnimationId);
            const startTime = performance.now();
            const duration = 300; // 0.3 seconds

            function animate(currentTime) {
                const elapsedTime = currentTime - startTime;
                popOutProgress = Math.min(elapsedTime / duration, 1);
                drawWheel();
                if (popOutProgress < 1) {
                    popOutAnimationId = requestAnimationFrame(animate);
                }
            }
            popOutAnimationId = requestAnimationFrame(animate);
        }

        function getContrastColor(hexcolor) {
            if (hexcolor.slice(0, 1) === '#') hexcolor = hexcolor.slice(1);
            const r = parseInt(hexcolor.substr(0, 2), 16);
            const g = parseInt(hexcolor.substr(2, 2), 16);
            const b = parseInt(hexcolor.substr(4, 2), 16);
            const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return (yiq >= 128) ? '#1e293b' : '#ffffff';
        }

        function setupItems() {
            const itemNames = itemsTextarea.value.split('\n').map(name => name.trim()).filter(name => name.length > 0);
            if(itemNames.length < 2){
                alert("í•­ëª©ì„ 2ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }
            items = itemNames.map((name, i) => ({
                name,
                color: colors[i % colors.length],
                selected: false
            }));
            reset();
        }

        function updateDrawnItemList() {
            drawnItemList.innerHTML = '';
            const selectedItems = items.filter(item => item.selected);
            if (selectedItems.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'ì•„ì§ ë½‘íŒ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.';
                li.classList.add('italic', 'text-slate-400');
                drawnItemList.appendChild(li);
            } else {
                selectedItems.forEach((item) => {
                    const li = document.createElement('li');
                    li.textContent = `ğŸ‰ ${item.name}`;
                    li.classList.add('font-medium');
                    drawnItemList.appendChild(li);
                });
            }
        }

        function showWinnerMessage(name) {
            winnerName.textContent = name;
            winnerMessage.style.display = 'block';
            setTimeout(() => {
                winnerMessage.style.display = 'none';
            }, 10000); // 5ì´ˆ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§
        }

        function spin() {
            if (isSpinning || winnerItem) return;
            const activeItems = items.filter(item => !item.selected);
            if (activeItems.length === 0) {
                alert('ëª¨ë“  í•­ëª©ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤. ì´ˆê¸°í™” í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            isSpinning = true;
            spinButton.disabled = true;
            if (popOutAnimationId) cancelAnimationFrame(popOutAnimationId);
            popOutProgress = 0;

            // í‹±í†¡ ì†Œë¦¬ ì‹œì‘ (ì ì  ëŠë ¤ì§€ëŠ” íš¨ê³¼)
            let tickSpeed = 50; // ì‹œì‘ ì†ë„ (ms)
            tickInterval = setInterval(() => {
                playTickSound();
                tickSpeed *= 1.05; // ì ì  ëŠë ¤ì§
                clearInterval(tickInterval);
                tickInterval = setInterval(() => {
                    playTickSound();
                    tickSpeed *= 1.05;
                    if (tickSpeed > 300) {
                        clearInterval(tickInterval);
                    }
                }, tickSpeed);
            }, tickSpeed);

            const winnerIndexOnWheel = Math.floor(Math.random() * activeItems.length);
            const winner = activeItems[winnerIndexOnWheel];

            const arcSizeDeg = 360 / activeItems.length;
            const stopAngleDeg = winnerIndexOnWheel * arcSizeDeg + arcSizeDeg / 2;
            const randomOffsetDeg = (Math.random() - 0.5) * (arcSizeDeg * 0.8);
            const finalAngleDeg = 270 - (stopAngleDeg + randomOffsetDeg);
            const spinAngleDeg = 360 * 10 + finalAngleDeg;

            canvas.style.transition = 'none';
            const currentActualRotation = currentRotation % 360;
            canvas.style.transform = `rotate(${currentActualRotation}deg)`;
            
            canvas.getBoundingClientRect(); // Force reflow

            setTimeout(() => {
                canvas.style.transition = 'transform 5s cubic-bezier(0.25, 1, 0.5, 1)';
                currentRotation = spinAngleDeg;
                canvas.style.transform = `rotate(${currentRotation}deg)`;
            }, 10);

            canvas.addEventListener('transitionend', () => {
                // í‹±í†¡ ì†Œë¦¬ ì¤‘ì§€
                if (tickInterval) {
                    clearInterval(tickInterval);
                    tickInterval = null;
                }
                
                isSpinning = false;
                winnerItem = winner;
                animateWinnerPopOut();
                
                // ìŠ¹ë¦¬ íš¨ê³¼ìŒ ì¬ìƒ
                playWinSound();
                
                // ë‹¹ì²¨ ë©”ì‹œì§€ í‘œì‹œ
                showWinnerMessage(winner.name);
                
                // Add a listener to the whole window to confirm the winner
                setTimeout(() => {
                    window.addEventListener('click', confirmWinner, { once: true });
                }, 100); // Small delay to prevent spin click from confirming
            }, { once: true });
        }
        
        function confirmWinner() {
            if (!winnerItem || isSpinning) return;

            const originalIndex = items.findIndex(item => item.name === winnerItem.name);
            if (originalIndex !== -1) items[originalIndex].selected = true;
            
            winnerItem = null;
            if (popOutAnimationId) cancelAnimationFrame(popOutAnimationId);
            popOutProgress = 0;

            updateDrawnItemList();
            drawWheel();

            const remainingItems = items.filter(item => !item.selected);
            if (remainingItems.length > 0) {
                spinButton.disabled = false;
                spinButton.textContent = "ë‹¤ì‹œ ë½‘ê¸°";
            } else {
                spinButton.textContent = "ëª¨ë‘ ë½‘ìŒ";
            }
        }

        function reset() {
            items.forEach(item => item.selected = false);
            isSpinning = false;
            winnerItem = null;
            if (popOutAnimationId) cancelAnimationFrame(popOutAnimationId);
            popOutProgress = 0;
            currentRotation = 0;
            canvas.style.transition = 'none';
            canvas.style.transform = `rotate(0deg)`;
            
            window.removeEventListener('click', confirmWinner);

            updateDrawnItemList();
            
            if (items.length > 0) {
                drawWheel();
                spinButton.disabled = false;
                spinButton.textContent = "ëŒë¦¬ê¸°!";
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                spinButton.disabled = true;
            }
        }
        
        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function openItemsModal() {
            itemsModal.style.display = 'block';
        }

        function closeItemsModal() {
            itemsModal.style.display = 'none';
        }

        function openDrawnModal() {
            drawnModal.style.display = 'block';
        }

        function closeDrawnModal() {
            drawnModal.style.display = 'none';
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.addEventListener('click', (event) => {
            if (event.target === itemsModal) {
                closeItemsModal();
            }
            if (event.target === drawnModal) {
                closeDrawnModal();
            }
        });

        setButton.addEventListener('click', () => {
            setupItems();
            closeItemsModal();
        });
        editButton.addEventListener('click', openItemsModal);
        cancelButton.addEventListener('click', closeItemsModal);
        showDrawnButton.addEventListener('click', openDrawnModal);
        closeDrawnButton.addEventListener('click', closeDrawnModal);
        spinButton.addEventListener('click', spin);
        resetButton.addEventListener('click', reset);
        window.addEventListener('resize', resizeCanvas);

        spinButton.disabled = true;
        resizeCanvas();
        itemsTextarea.value = `ì•ˆì¸ìˆ™
ì†í˜„ë•
ìµœê²½ìˆœ
ê¹€ê°€í˜„
ê¹€ë„í˜„
ê¹€ë™ì™„
ê¹€ë¯¸ì˜
ê¹€ë¯¼ì•„
ê¹€ë³‘ìš±
ê¹€ì†Œë§
ê¹€ì†Œìœ¨
ê¹€ìš©ìš°
ê¹€ì¬ì˜
ê¹€ì§€ìˆ˜
ê¹€ì°¬ë¯¸
ê¹€í˜œì£¼
ì´ëª…ì´
ë°•ë‹¤ì •
ë°•ìˆ˜ì§„
ë°•ì˜í¬
ë°•ì •ë¯¼
ë°©ë¯¼í¬
ë°°ìˆ˜ì—°
ì´ë¯¼ì£¼
ì„œì§€ì›
ì„œí•˜ë‚˜
ì†¡ìœ¤ìˆ™
ì†¡í¬ì§„
ì‹¬ì •í¬
ì•ˆì§€ì€(êµ­)
ìœ¤ì§€ì›
ì–‘ìˆ˜ì—°
ê¹€íš¨ì§„
ì •ì€ê²½
ìœ ì¢…ì—°
ìœ¤ê¸°ì˜
ìœ¤ì¤€ë²”
ì´ìƒí›ˆ(ì˜)
ì´ìƒí›ˆ(í–‰)
ì´ìˆ˜í˜„
ì´ì€í˜œ
ì´ì •í™”
ì´ì •í¬
ì´í•´ë¦¼
ì´í˜„ì£¼
ì•ˆì§€ì€(ê³¼)
ì„ìˆ˜í¬
ì¥ì˜ˆë¦°
ì¥ìš°ì •
ì˜¤ìœ ë¯¸
ì •ìŠ¹í™˜
ì •í•„ì„ 
ì •í˜¸ì¤€
ì¡°ì„±ì¤€
ìµœì„±ê·¼
ìµœì£¼ì˜
ìµœí˜„ì§€
í™ì£¼ë¯¸
ì´ì˜ë€
ì†ì •ì¼
ì„œì§€ì• 
ìœ¤í˜œì •
ê¹€ì¬í—Œ
ìœ ì¬í˜„
ë°•ì• ì`;
        setupItems();
    </script>
</body>
</html>

